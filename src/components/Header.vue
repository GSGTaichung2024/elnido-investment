<template>
<!--===== PRELOADER STARTS =======-->
<div id="preloader">
  <div id="ctn-preloader" class="ctn-preloader">
    <div class="animation-preloader">
        <div class="txt-loading">
            <span data-text-preloader="E" class="letters-loading">
              E
            </span>
            <span data-text-preloader="L" class="letters-loading">
               L
            </span>
            <span data-text-preloader="N" class="letters-loading">
                N
            </span>
            <span data-text-preloader="I" class="letters-loading">
                I
            </span>
            <span data-text-preloader="D" class="letters-loading">
                D
            </span>
            <span data-text-preloader="O" class="letters-loading">
                O
            </span>
        </div>
    </div>
  </div>
</div>
<!--===== PRELOADER ENDS =======-->

  <!--===== PAGE PROGRESS START=======-->
  <div class="paginacontainer">
    <div class="progress-wrap">
      <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
      </svg>
    </div>
  </div>
<!--===== PAGE PROGRESS END=======-->

   <!--=====HEADER START=======-->
   <header>
    <div class="header-area homepage1 header header-sticky d-none d-lg-block " id="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header-elements">
              <div class="site-logo">
                <a href="/">
                  <img src="/assets/img/logo/logo1.png" alt="愛尼島夢想投資">
                </a>
              </div>
              <div class="main-menu">
                <ul>
                  <li><a href="/">首頁</a></li>
                  <li><a href="/why-elnido">為什麼選擇愛尼島</a></li>
                  <li><a href="#">投資項目 <i class="fa-solid fa-angle-down"></i></a>
                    <ul class="dropdown-padding">
                      <li><a href="/investment/piecelio">Piecelio</a></li>
                      <li><a href="/investment/m-coast">暱名M海岸旅館</a></li>
                    </ul>
                  </li>
                  <li><a href="#">關於我們 <i class="fa-solid fa-angle-down"></i></a>
                    <ul class="dropdown-padding">
                      <li><a href="/about/hhotelgroup">開發商介紹</a></li>
                      <li><a href="/about/piece-hostel">旅館管理公司</a></li>
                    </ul>
                  </li>
                  <li><a href="/faq">常見問題</a></li>
                  <li><a href="/contact">聯絡我們</a></li>
                </ul>
              </div>
              <div class="btn-area">
                <div class="search-icon header__search header-search-btn">
                  <a href="#"><img src="/assets/img/icons/search1.svg" alt=""></a>
                </div>
                <a href="/contact" class="header-btn1">立即諮詢 <img src="/assets/img/icons/arrow1.svg" alt=""></a>
              </div>

              <div class="header-search-form-wrapper">
                <div class="tx-search-close tx-close"><i class="fa-solid fa-xmark"></i></div>
                <div class="header-search-container">
                    <form role="search" class="search-form">
                    <input type="search"  class="search-field" placeholder="搜尋 …" value="" name="s">
                    <button type="submit" class="search-submit"><img src="/assets/img/icons/search1.svg" alt=""></button>
                    </form>
                </div>
            </div>
            <div class="body-overlay"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--=====HEADER END =======-->

  <!--===== MOBILE HEADER STARTS =======-->
 <div class="mobile-header mobile-haeder1 d-block d-lg-none">
  <div class="container-fluid">
    <div class="col-12">
      <div class="mobile-header-elements">
        <div class="mobile-logo">
          <a href="/"><img src="/assets/img/logo/logo2.png" alt="愛尼島夢想投資"></a>
        </div>
        <div class="mobile-nav-icon dots-menu">
          <i class="fa-solid fa-bars-staggered"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mobile-sidebar mobile-sidebar1">
  <div class="logosicon-area">
    <div class="logos">
      <img src="/assets/img/logo/logo2.png" alt="愛尼島夢想投資">
    </div>
    <div class="menu-close">
      <i class="fa-solid fa-xmark"></i>
    </div>
   </div>
  <div class="mobile-nav mobile-nav1">
    <ul class="mobile-nav-list nav-list1">
      <li><a href="/">首頁</a></li>
      <li><a href="/why-elnido">為什麼選擇愛尼島</a></li>
      <li><a href="#">投資項目</a>
        <ul class="sub-menu">
          <li><a href="/investment/piecelio">Piecelio</a></li>
          <li><a href="/investment/m-coast">暱名M海岸旅館</a></li>
        </ul>
      </li>
      <li><a href="#">關於我們</a>
        <ul class="sub-menu">
          <li><a href="/about/hhotelgroup">開發商介紹</a></li>
          <li><a href="/about/piece-hostel">旅館管理公司</a></li>
        </ul>
      </li>
      <li><a href="/faq">常見問題</a></li>
      <li><a href="/contact">聯絡我們</a></li>
    </ul>
    <div class="allmobilesection">
      <a href="/contact" class="header-btn1">立即諮詢 <span><i class="fa-solid fa-arrow-right"></i></span></a>
      <div class="single-footer">
        <h3>聯絡資訊</h3>
        <div class="footer1-contact-info">
          <div class="contact-info-single">
            <div class="contact-info-icon">
              <span><i class="fa-solid fa-phone-volume"></i></span>
            </div>
            <div class="contact-info-text">
              <a href="tel:+886-2-xxxx-xxxx">+886-2-xxxx-xxxx</a>
            </div>
          </div>
          <div class="contact-info-single">
            <div class="contact-info-icon">
              <span><i class="fa-solid fa-envelope"></i></span>
            </div>
            <div class="contact-info-text">
              <a href="mailto:info@elnido.com">info@elnido.com</a>
            </div>
          </div>
          <div class="single-footer">
            <h3>地址</h3>
            <div class="contact-info-single">
              <div class="contact-info-icon">
                <span><i class="fa-solid fa-location-dot"></i></span>
              </div>
              <div class="contact-info-text">
                <a href="#">台北市信義區信義路五段7號</a>
              </div>
            </div>
          </div>
          <div class="single-footer">
            <h3>社群連結</h3> 
            <div class="social-links-mobile-menu">
              <ul>
                <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-line"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
     </div>
  </div>
</div>
<!--===== MOBILE HEADER STARTS =======-->
</template>

<script>
import { useI18n } from "vue-i18n";
import { ref, onMounted, computed } from "vue";
import { useRouter, useRoute } from "vue-router";

export default {
  name: "Header",
  setup() {
    const { t, locale } = useI18n();
    const route = useRoute();
    const router = useRouter();

    const localeOptions = ref([
      {
        lang: "eng",
        name: "English",
      },
      {
        lang: "zh_TW",
        name: "繁中",
      },
      {
        lang: "zh_CN",
        name: "簡中",
      },
    ]);

    const isHome = computed(() => {
      return route.name === "home";
    });

    const urlSetLocale = (lang) => {
      const currentPath = route.path;
      const currentName = route.name;
      const currentParams = route.params;

      let newPath = `/${lang}`;

      if (currentName) {
        const matchedRoute = route.matched[route.matched.length - 1];
        if (matchedRoute) {
          newPath += matchedRoute.path.replace(/^\/[^\/]+/, "");
        }

        if (Object.keys(currentParams).length > 0) {
          for (const [key, value] of Object.entries(currentParams)) {
            if (key !== "locale") {
              newPath = newPath.replace(`:${key}`, value);
            }
          }
        }
      } else {
        newPath = currentPath.replace(/^\/[^\/]+/, `/${lang}`);
      }

      window.location.href = newPath;
    };

    const setLocale = (lang) => {
      locale.value = lang;
      localStorage.setItem("locale", lang);

      const currentPath = route.path;
      const currentName = route.name;
      const currentParams = route.params;

      let newPath = `/${lang}`;

      if (currentName) {
        const matchedRoute = route.matched[route.matched.length - 1];
        if (matchedRoute) {
          newPath += matchedRoute.path.replace(/^\/[^\/]+/, "");
        }

        if (Object.keys(currentParams).length > 0) {
          for (const [key, value] of Object.entries(currentParams)) {
            if (key !== "locale") {
              newPath = newPath.replace(`:${key}`, value);
            }
          }
        }
      } else {
        newPath = currentPath.replace(/^\/[^\/]+/, `/${lang}`);
      }

      window.location.href = newPath;
    };

    onMounted(() => {
      const urlLocale = route.params.locale;
      const storedLocale = localStorage.getItem("locale");

      if (!urlLocale && !storedLocale) {
        setLocale("zh_TW");
      } else if (urlLocale && urlLocale !== storedLocale) {
        setLocale(urlLocale);
      } else if (!urlLocale && storedLocale) {
        locale.value = storedLocale;
      }

      // Add scroll progress functionality
      const progressPath = document.querySelector(".progress-wrap path");
      const pathLength = 1080;
      progressPath.style.transition = progressPath.style.WebkitTransition = "none";
      progressPath.style.strokeDasharray = pathLength + " " + pathLength;
      progressPath.style.strokeDashoffset = pathLength;
      progressPath.getBoundingClientRect();
      progressPath.style.transition = progressPath.style.WebkitTransition = "stroke-dashoffset 10ms linear";

      const updateProgress = () => {
        const scroll = window.scrollY;
        const height = document.documentElement.scrollHeight - window.innerHeight;
        const progress = pathLength - (scroll * pathLength) / height;
        progressPath.style.strokeDashoffset = progress;
      };

      updateProgress();
      window.addEventListener('scroll', updateProgress);

      const offset = 50;
      const duration = 550;

      window.addEventListener('scroll', () => {
        if (window.scrollY > offset) {
          document.querySelector(".progress-wrap").classList.add("active-progress");
        } else {
          document.querySelector(".progress-wrap").classList.remove("active-progress");
        }
      });

      document.querySelector(".progress-wrap").addEventListener('click', (event) => {
        event.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth',
          duration: duration
        });
      });
    });

    return {
      t,
      locale,
      setLocale,
      urlSetLocale,
      localeOptions,
      isHome,
    };
  },
};
</script>
